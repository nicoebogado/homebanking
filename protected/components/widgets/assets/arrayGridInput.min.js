!function(t){function a(t,a){return t.replace(/(\w*)(\[(\w*)\])/,"$1["+a+"]$2")}function n(t,a){return!!t.data("labelid")&&t.prop("name").replace(/(\w*)(\[(\w*)\])/,"$1["+a+"]["+t.data("labelid")+"]")}function e(t){return t.is("select")?t.children("option:selected").text():t.val()}function d(t,n){return o(a(t.prop("name"),n),t.val())}function o(a,n){return t("<input>").prop("type","hidden").prop("name",a).val(n)}function i(t){var a=JSON.stringify(t);return window.btoa(a)}function r(){return t("<button>").addClass("btn btn-danger eliminar-fila").prop("title","Eliminar").append(t("<i>").addClass("icon-close"))}t(document).ready(function(){t(".agi-modal").on("submit","form",function(a){var l,p,c=t(this),s=c.find(":input"),u=(c.data("agimodel"),t("<tr>")),f=c.data("containerid"),m=c.data("modelid"),b=c.data("formurl");a.preventDefault();var v=0;if(m)v=m;else{var h=t("div#"+f+">table>tbody>tr:last-child").find("input.modelId");v=h?parseInt(h.val())+1:0}for(var y=!0,g={},w=0;w<s.length;w++)if(l=t(s[w]),l.hasClass("form-control")){if(g[l.data("attrname")]=l.val(),p=t("<td>"),y&&(p.append(o("modelId",v).addClass("modelId")),y=!1),p.append(e(l)).append(d(l,v)),l.is("select")){var I=l.children("option:selected").text();p.append(o(n(l,v),I))}u.append(p)}if(m){var x=t("button#btn-editar-"+f+"-"+m).closest("tr"),C={model:i(g),containerId:f,modelId:m},$=t('<button class="btn btn-primary editar-fila" id="btn-editar-'+f+"-"+m+'" type="button" data-toggle="modal" data-target="#modal-form" data-formurl="'+b+"\" data-formdatas='"+JSON.stringify(C)+'\'><i class="icon-pencil"></i></button>');u.append(t("<td>").append($)),x.replaceWith(u)}else u.append(t("<td>").append(r())),t("div#"+f+">table>tbody").append(u);c.closest("div.modal").modal("hide")}).on("hidden.bs.modal",function(){t("#modal-form-body").text("Recuperando datos...")}),t(".agi-table").on("click","button.editar-fila",function(){var a=t(this),n=a.data("formurl"),e=a.data("formdatas");return t.ajax({url:n,data:e,cache:!1,success:function(a){t("#modal-form-body").html(a)}}),!0}).on("click","button.eliminar-fila",function(){t(this).closest("tr").remove()})})}(jQuery);